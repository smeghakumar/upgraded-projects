<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="post-signup-sub-flow" doc:id="e88a7151-7863-4377-9ae2-3cc9d6d14409" >
		<logger level="INFO" doc:name="Start Logger" doc:id="bce2afbb-d139-4031-9f30-d46837134025" message="Start post-signup-sub-flow" category="${logger.category}.post-signup-sub-flow" />
		<ee:transform doc:name="Var requestPayload/path/method" doc:id="431b76b6-026b-448f-8f0c-706c0c81edba" >
			<ee:variables >
				<ee:set-variable resource="dwl/post-signup-request.dwl" variableName="requestPayload" />
				<ee:set-variable variableName="method" ><![CDATA[p('okta.signup.method')]]></ee:set-variable>
				<ee:set-variable variableName="path" ><![CDATA[p('okta.signup.path')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<logger level="INFO" doc:name="INFO: Before Okta Request call" doc:id="e0a6e88f-41e8-4a31-aaa3-ff17a704a665" message="Before request-okta-sub-flow call" category="${logger.category}.post-signup-sub-flow" />
		<flow-ref doc:name="request-okta-sub-flow" doc:id="1ca50d22-342a-468d-a167-c9a87c759b33" name="request-okta-sub-flow"/>
		<logger level="INFO" doc:name="INFO: After Okta Request call" doc:id="c6c9985e-3fab-4935-9cb3-3e0f9dd0acae" message="After request-okta-sub-flow call" category="${logger.category}.post-signup-sub-flow" />
		<choice doc:name="Check isError" doc:id="7e114612-3480-4387-b6eb-44729cd6d8c8">
			<when expression="#[vars.isError == true]">
				<raise-error doc:name="HEA_OKTA_SAPI:USER_SIGNUP_FAILED" doc:id="6638b724-361f-418f-b229-f80c3322c21f" type="HEA_OKTA_SAPI:USER_SIGNUP_FAILED" description="#[payload]" />
			</when>
			<otherwise>
				<logger level="INFO" doc:name="INFO Logger" doc:id="6d9e5e2e-401b-4be0-ae20-a7b1a2a5dcac" message="User signup is successful." category="${logger.category}.post-signup-sub-flow" />
				<ee:transform doc:name="Response" doc:id="4e0a4e33-32d9-4ba7-8040-48cddf4edade">
			<ee:message>
				<ee:set-payload resource="dwl/post-signup-response.dwl" />
			</ee:message>
		</ee:transform>
			</otherwise>
		</choice>
		<logger level="INFO" doc:name="End Logger" doc:id="827930f2-83d1-47bd-a1d2-f36baba14b14" message="End post-signup-sub-flow" category="${logger.category}.post-signup-sub-flow" />
	</sub-flow>
</mule>
